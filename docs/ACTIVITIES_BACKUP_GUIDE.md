# Activities Backup and Recovery Guide

This document explains the best practices for backing up, restoring, and managing activities in the Tick-Tock application.

## Understanding Activities Storage

Activities are stored in JSON files in the `src/data/activities/` directory:

- **default-activities.json**: The primary activities file used by the application
- **imported-activities.json**: Generated by the import script but not automatically used
- **default-activities.backup.TIMESTAMP.json**: Backup files created during updates

## Automatic Backup System

The activity conversion script includes an intelligent backup system:

1. **Automatic Backup Creation**: When using `--replace-default`, a backup is automatically created
2. **Timestamped Filenames**: Backups include a Unix timestamp (e.g., `default-activities.backup.1752765378.json`)
3. **Original Preservation**: The entire original file is preserved, not just a diff

## Backup Workflow

### Creating Backups

Backups are automatically created when replacing default activities:

```bash
# This creates a backup before replacing the file
npm run generate-activities -- --sheet-url https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/edit --replace-default
```

You'll see a message like:
```
Backed up existing file to: src/data/activities/default-activities.backup.1752765378.json
```

### Manual Backup Creation

You can also create a manual backup anytime:

```bash
# Create a manual backup with current date
cp src/data/activities/default-activities.json src/data/activities/default-activities.backup.$(date +%s).json
```

### Skipping Backups (Not Recommended)

In rare cases, you might want to skip backup creation:

```bash
npm run generate-activities -- --sheet-url https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/edit --replace-default --no-backup
```

⚠️ **Warning**: This is not recommended as it risks data loss.

## Restoring from Backup

### Finding Available Backups

List all available backups:

```bash
ls -la src/data/activities/default-activities.backup.*.json
```

### Restoring a Specific Backup

To restore from a backup:

```bash
# Replace default-activities.json with a specific backup
cp src/data/activities/default-activities.backup.1752765378.json src/data/activities/default-activities.json
```

### Testing a Backup Without Replacing Default

To test a backup without replacing the default file:

```bash
# Copy to imported-activities.json for testing
cp src/data/activities/default-activities.backup.1752765378.json src/data/activities/imported-activities.json

# Then modify your app code temporarily to use imported-activities.json instead
```

## Backup Management Strategies

### Backup Rotation

To prevent accumulating too many backups:

```bash
# Keep only the 5 most recent backups
ls -t src/data/activities/default-activities.backup.*.json | tail -n +6 | xargs rm -f
```

### Important Backup Preservation

To preserve an important backup permanently:

```bash
# Copy with descriptive name
cp src/data/activities/default-activities.backup.1752765378.json src/data/activities/default-activities.important-backup-v2.json
```

## Safe Testing Approach

To safely test changes without affecting your default activities:

1. **Generate to a separate file**:
   ```bash
   npm run generate-activities -- --sheet-url https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/edit --filename test-activities.json
   ```

2. **Modify your app code temporarily** to use this test file:
   ```javascript
   // In src/utils/dataLoader.js (temporarily)
   import defaultActivities from '../data/activities/test-activities.json';
   ```

3. **After verification**, replace the default activities:
   ```bash
   npm run generate-activities -- --sheet-url https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/edit --replace-default
   ```

## Disaster Recovery

If something goes wrong and you need to restore:

### Emergency Restoration

```bash
# Find the most recent backup
LATEST_BACKUP=$(ls -t src/data/activities/default-activities.backup.*.json | head -1)

# Restore it
cp $LATEST_BACKUP src/data/activities/default-activities.json
```

### Reset to Repository Version

If all backups are corrupted, you can reset to the repository version:

```bash
git checkout -- src/data/activities/default-activities.json
```

## Best Practices

1. **Always use `--replace-default`** when updating default activities (auto-creates backups)
2. **Perform dry runs first** with `--dry-run` before replacing files
3. **Regularly clean up old backups** after confirming new activities work correctly
4. **Keep at least 3 recent backups** in case issues are discovered later
5. **Consider committing important backups** to your repository
6. **Document significant activity changes** in commit messages
7. **Test with `imported-activities.json`** before replacing default activities

## Comparing Activities Files

To compare activities between files:

```bash
# Visual diff in VS Code
code --diff src/data/activities/default-activities.json src/data/activities/imported-activities.json

# Or using command line
diff -u src/data/activities/default-activities.json src/data/activities/imported-activities.json | less
```

This helps you understand what changes will be made before replacing the default file.

## GitHub Integration

When sharing your activities:

1. **Include the conversion script**: So others can modify and update activities
2. **Document the Google Sheets URL**: In your README or documentation
3. **Consider sharing a template Google Sheet**: That others can copy and modify
4. **Include clear backup instructions**: In your documentation